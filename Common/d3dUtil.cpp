#include "d3dUtil.h"

void ExtractFrustumPlanes(XMFLOAT4 planes[6], CXMMATRIX T)
{
    XMFLOAT4X4 M;
    XMStoreFloat4x4(&M, T);
    //
    // Left
    //
    planes[0].x = M(0, 3) + M(0, 0);
    planes[0].y = M(1, 3) + M(1, 0);
    planes[0].z = M(2, 3) + M(2, 0);
    planes[0].w = M(3, 3) + M(3, 0);

    //
    // Right
    //
    planes[1].x = M(0, 3) - M(0, 0);
    planes[1].y = M(1, 3) - M(1, 0);
    planes[1].z = M(2, 3) - M(2, 0);
    planes[1].w = M(3, 3) - M(3, 0);

    //
    // Bottom
    //
    planes[2].x = M(0, 3) + M(0, 1);
    planes[2].y = M(1, 3) + M(1, 1);
    planes[2].z = M(2, 3) + M(2, 1);
    planes[2].w = M(3, 3) + M(3, 1);

    //
    // Top
    //
    planes[3].x = M(0, 3) - M(0, 1);
    planes[3].y = M(1, 3) - M(1, 1);
    planes[3].z = M(2, 3) - M(2, 1);
    planes[3].w = M(3, 3) - M(3, 1);

    //
    // Near
    //
    planes[4].x = M(0, 2);
    planes[4].y = M(1, 2);
    planes[4].z = M(2, 2);
    planes[4].w = M(3, 2);

    //
    // Far
    //
    planes[5].x = M(0, 3) - M(0, 2);
    planes[5].y = M(1, 3) - M(1, 2);
    planes[5].z = M(2, 3) - M(2, 2);
    planes[5].w = M(3, 3) - M(3, 2);

    // Normalize the plane equations.
    for (int i = 0; i < 6; ++i)
    {
        XMVECTOR v = XMPlaneNormalize(XMLoadFloat4(&planes[i]));
        XMStoreFloat4(&planes[i], v);
    }
}
